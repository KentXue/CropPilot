# 📊 CropPilot数据可视化功能使用指南

## 🎯 功能概述

CropPilot系统新增了强大的数据可视化功能，可以将传感器数据转换为直观的图表，帮助用户更好地理解农田环境变化趋势。

## 🌟 主要特性

### 📈 多类型图表
- **温度湿度趋势图**: 双轴显示温度和湿度变化
- **土壤参数图表**: 土壤湿度和pH值监测
- **营养元素分析**: NPK三要素含量趋势
- **光照强度图表**: 光照条件变化监测

### 📊 数据统计
- **自动统计**: 平均值、最大值、最小值
- **时间范围**: 支持7天、30天、90天数据查看
- **实时更新**: 数据变化实时反映在图表中

## 🚀 快速开始

### 1. 启动系统
```bash
# 确保依赖已安装
pip install -r requirements.txt

# 启动Flask应用
python src/app.py

# 访问系统
http://localhost:5000
```

### 2. 生成演示数据
1. 点击 **"数据可视化"** 标签页
2. 选择一个地块
3. 点击 **"🎲 生成演示数据"** 按钮
4. 系统会自动生成7天的模拟传感器数据

### 3. 查看图表
1. 选择地块和时间范围
2. 点击 **"📈 加载图表"** 按钮
3. 系统会显示4个不同类型的图表

## 📋 详细使用步骤

### 步骤1: 准备数据

#### 方法A: 使用演示数据（推荐）
```
1. 进入"数据可视化"页面
2. 选择地块
3. 点击"生成演示数据"
4. 等待数据生成完成
```

#### 方法B: 录入真实数据
```
1. 进入"传感器数据"页面
2. 选择地块
3. 填写各项传感器数据
4. 点击"保存传感器数据"
5. 重复多次以积累足够数据
```

### 步骤2: 查看可视化

#### 基本操作
```
1. 选择地块: 从下拉列表选择要分析的地块
2. 选择时间范围: 7天/30天/90天
3. 加载图表: 点击"加载图表"按钮
4. 刷新数据: 点击"刷新"按钮更新图表
```

#### 图表交互
```
- 鼠标悬停: 查看具体数值
- 图例点击: 显示/隐藏数据系列
- 缩放功能: 部分图表支持缩放查看
```

## 📊 图表说明

### 1. 温度 & 湿度趋势图
- **左轴**: 温度 (°C)
- **右轴**: 湿度 (%)
- **用途**: 监测环境温湿度变化，判断是否适宜作物生长

### 2. 土壤湿度 & pH值图
- **左轴**: 土壤湿度 (%)
- **右轴**: pH值
- **用途**: 监测土壤状态，指导灌溉和土壤改良

### 3. NPK营养元素趋势图
- **氮 (N)**: 紫色线条
- **磷 (P)**: 蓝色线条  
- **钾 (K)**: 粉色线条
- **用途**: 监测土壤营养状况，指导施肥决策

### 4. 光照强度变化图
- **单位**: lux
- **用途**: 监测光照条件，评估光合作用效率

## 📈 数据统计摘要

每个图表下方都有对应的统计卡片，显示：
- **平均值**: 时间段内的平均水平
- **最大值**: 时间段内的峰值
- **最小值**: 时间段内的最低值

## 🔧 故障排除

### 常见问题

**Q: 图表显示"该地块暂无传感器数据"**
```
解决方案:
1. 确认已选择正确的地块
2. 使用"生成演示数据"功能
3. 或手动录入一些传感器数据
```

**Q: 图表加载失败**
```
解决方案:
1. 检查网络连接
2. 确认Flask服务器正在运行
3. 刷新页面重试
```

**Q: 数据显示不完整**
```
解决方案:
1. 调整时间范围
2. 检查数据库中的数据完整性
3. 重新生成演示数据
```

### 技术问题

**Chart.js加载失败**
```
- 检查网络连接（需要CDN访问）
- 或下载Chart.js到本地static目录
```

**数据格式错误**
```
- 检查传感器数据的数值格式
- 确保时间戳格式正确
```

## 🎨 自定义配置

### 修改图表样式
编辑 `templates/index.html` 中的Chart.js配置：
```javascript
// 修改颜色
borderColor: '#your-color'
backgroundColor: 'rgba(your-color, 0.1)'

// 修改图表类型
type: 'line' // 或 'bar', 'area' 等
```

### 添加新的数据类型
1. 在数据库中添加新字段
2. 修改API返回数据
3. 在前端添加新的图表配置

## 📝 最佳实践

### 数据录入建议
- **定期录入**: 建议每天录入2-4次数据
- **时间一致**: 尽量在固定时间点录入
- **数据完整**: 尽量填写所有传感器参数

### 图表分析建议
- **趋势观察**: 关注数据的变化趋势而非单点数值
- **异常识别**: 注意突然的数值跳跃或异常点
- **对比分析**: 结合多个参数进行综合分析

## 🚀 未来扩展

计划中的功能增强：
- [ ] 异常数据自动标注
- [ ] 数据预测和趋势分析
- [ ] 多地块对比分析
- [ ] 图表数据导出功能
- [ ] 自定义图表配置

---

**使用愉快！** 如有问题，请参考系统帮助或联系技术支持。